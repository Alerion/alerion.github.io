(function(t){function e(e){for(var i,s,c=e[0],u=e[1],o=e[2],h=0,f=[];h<c.length;h++)s=c[h],r[s]&&f.push(r[s][0]),r[s]=0;for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(t[i]=u[i]);l&&l(e);while(f.length)f.shift()();return a.push.apply(a,o||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],i=!0,c=1;c<n.length;c++){var u=n[c];0!==r[u]&&(i=!1)}i&&(a.splice(e--,1),t=s(s.s=n[0]))}return t}var i={},r={app:0},a=[];function s(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=i,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(n,i,function(e){return t[e]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/piano-trainer/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],u=c.push.bind(c);c.push=e,c=c.slice();for(var o=0;o<c.length;o++)e(c[o]);var l=u;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},1:function(t,e){},3854:function(t,e,n){},"41fc":function(t,e,n){"use strict";var i=n("ee77"),r=n.n(i);r.a},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("f751"),n("097d");var i,r,a,s,c=n("2b0e"),u=n("9f7b"),o=n("ecee"),l=n("c074"),h=n("ad3d"),f=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("b-navbar",{attrs:{toggleable:"sm",type:"dark",variant:"success"}},[n("b-navbar-brand",{attrs:{href:"home"}},[t._v("Piano Trainer")]),n("b-collapse",{attrs:{"is-nav":"",id:"nav_collapse"}},[n("b-navbar-nav",{staticClass:"ml-auto"},[n("output-devices-selector"),n("input-devices-selector")],1)],1)],1),n("router-view")],1)},p=[],d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-nav-text",[n("fa-icon",{attrs:{icon:"volume-up"}}),t._v("\n    "+t._s(t.inputName)+"\n")],1)},v=[],b=(n("7f7f"),n("d225")),O=n("b0b4"),m=n("308d"),g=n("6bb5"),y=n("4e2b"),j=n("013f"),_=n("bd86"),w=n("65d9"),k=n.n(w),I=k()((r=function(t){function e(){var t,n;Object(b["a"])(this,e);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return n=Object(m["a"])(this,(t=Object(g["a"])(e)).call.apply(t,[this].concat(r))),Object(_["a"])(Object(j["a"])(Object(j["a"])(n)),"devices",null),n}return Object(y["a"])(e,t),Object(O["a"])(e,[{key:"created",value:function(){this.devices=this.$MIDI}},{key:"inputName",get:function(){return this.devices.currentInput?this.devices.currentInput.name:"Loading..."}}]),e}(c["default"]),i=r))||i,x=I,M=(n("c2ed"),n("2877")),S=Object(M["a"])(x,d,v,!1,null,"62547b4e",null),E=S.exports,N=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-nav-text",[n("fa-icon",{attrs:{icon:"keyboard"}}),t._v("\n    "+t._s(t.outputName)+"\n")],1)},D=[],R=k()((s=function(t){function e(){var t,n;Object(b["a"])(this,e);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return n=Object(m["a"])(this,(t=Object(g["a"])(e)).call.apply(t,[this].concat(r))),Object(_["a"])(Object(j["a"])(Object(j["a"])(n)),"devices",null),n}return Object(y["a"])(e,t),Object(O["a"])(e,[{key:"created",value:function(){this.devices=this.$MIDI}},{key:"outputName",get:function(){var t=this.devices.currentOutput;return t&&t.initalized?t.name:"Loading..."}}]),e}(c["default"]),a=s))||a,C=R,L=(n("57e2"),Object(M["a"])(C,N,D,!1,null,"6810c2b2",null)),$=L.exports,P={components:{"output-devices-selector":E,"input-devices-selector":$}},T=P,z=(n("b4e0"),Object(M["a"])(T,f,p,!1,null,"18483824",null)),V=z.exports,A=n("8c4f"),B=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-container",{attrs:{fluid:""}},[n("b-alert",{attrs:{variant:"danger",show:t.error}},[t._v(t._s(t.error))]),n("b-alert",{attrs:{show:!t.ready&&!t.error}},[t._v("Loading...")]),!t.error&&t.ready?[n("b-row",[n("b-col",{staticClass:"sidebar",attrs:{cols:"3"}},[n("b-button",{on:{click:t.generate}},[t._v("Generate")]),n("b-button",{staticClass:"btn-play",on:{click:t.play}},[t._v("Play")]),n("b-alert",{attrs:{show:!!t.status}},[t._v(t._s(t.status))])],1),n("b-col",[n("b-alert",{attrs:{show:t.isCompleted,variant:"success"}},[t._v("Melody completed!")]),t.result?n("result-display",{attrs:{result:t.result}}):t._e()],1)],1)]:t._e()],2)},W=[],F=(n("96cf"),n("3b8d")),H=(n("ac6a"),n("768b")),U=n("fa11"),G=12,q=G,J=[1,2,4,8,16,32,64],Y=0,K=127,Q=32,X=100,Z=100,tt="note_on",et="note_off",nt="time_shift",it="velocity_change",rt=[[tt,Y,K],[et,Y,K],[nt,1,X],[it,1,Q]],at=rt.reduce(function(t,e){return t+(e[2]-e[1]+1)},0),st=355,ct=10,ut=function(){function t(){Object(b["a"])(this,t),Object(_["a"])(this,"MODEL_URL","/rnn/"),this.noteDensityIdx=1,this.pitchHistogram=[2,0,1,0,1,1,0,1,0,1,0,1],this.conditioning=this.calcConditioning(),this.fcB=null,this.fcW=null,this.c=null,this.h=null,this.lastSample=null}return Object(O["a"])(t,[{key:"init",value:function(){var t=Object(F["a"])(regeneratorRuntime.mark(function t(){var e,n,i;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!(!U["ENV"].get("WEBGL_VERSION")>=1)){t.next=2;break}throw new Error("We do not yet support your device. Please try on a desktop\n                computer with Chrome/Firefox, or an Android phone with WebGL support.");case 2:return t.next=4,fetch("".concat(this.MODEL_URL,"/weights_manifest.json"));case 4:return e=t.sent,t.next=7,e.json();case 7:return n=t.sent,t.next=10,U["loadWeights"](n,this.MODEL_URL);case 10:i=t.sent,this.kernel1=i["rnn/multi_rnn_cell/cell_0/basic_lstm_cell/kernel"],this.bias1=i["rnn/multi_rnn_cell/cell_0/basic_lstm_cell/bias"],this.kernel2=i["rnn/multi_rnn_cell/cell_1/basic_lstm_cell/kernel"],this.bias2=i["rnn/multi_rnn_cell/cell_1/basic_lstm_cell/bias"],this.kernel3=i["rnn/multi_rnn_cell/cell_2/basic_lstm_cell/kernel"],this.bias3=i["rnn/multi_rnn_cell/cell_2/basic_lstm_cell/bias"],this.forgetBias=U["scalar"](1),this.fcB=i["fully_connected/biases"],this.fcW=i["fully_connected/weights"],this.c=[U["zeros"]([1,this.bias1.shape[0]/4]),U["zeros"]([1,this.bias2.shape[0]/4]),U["zeros"]([1,this.bias3.shape[0]/4])],this.h=[U["zeros"]([1,this.bias1.shape[0]/4]),U["zeros"]([1,this.bias2.shape[0]/4]),U["zeros"]([1,this.bias3.shape[0]/4])],this.lastSample=U["scalar"](st,"int32");case 23:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"calcConditioning",value:function(){for(var t=U["oneHot"](U["tensor1d"]([this.noteDensityIdx+1],"int32"),J.length+1).as1D(),e=U["buffer"]([q],"float32"),n=this.pitchHistogram.reduce(function(t,e){return t+e}),i=0;i<q;i++)e.set(this.pitchHistogram[i]/n,i);var r=e.toTensor();return U["tidy"](function(){var e=0,n=t.concat(r,e);return U["tensor1d"]([0],"int32").concat(n,e)})}},{key:"generateSteps",value:function(){var t=this,e=this.fcB,n=this.fcW,i=this.conditioning,r=this.forgetBias,a=this.kernel1,s=this.kernel2,c=this.kernel3,u=this.bias1,o=this.bias2,l=this.bias3,h=function(t,e,n){return U["basicLSTMCell"](r,a,u,t,e,n)},f=function(t,e,n){return U["basicLSTMCell"](r,s,o,t,e,n)},p=function(t,e,n){return U["basicLSTMCell"](r,c,l,t,e,n)},d=this.c,v=this.h,b=this.lastSample,O=[],m=U["tidy"](function(){for(var t=[],r=0;r<ct;r++){var a=U["oneHot"](b.as1D(),at).as1D();0===r&&b.dispose();var s=0,c=i.concat(a,s).toFloat(),u=U["multiRNNCell"]([h,f,p],c.as2D(1,-1),d,v);d.forEach(function(t){return t.dispose()}),v.forEach(function(t){return t.dispose()});var o=Object(H["a"])(u,2);d=o[0],v=o[1];var l=v[2],O=l.matMul(n).add(e),m=U["multinomial"](O.as1D(),1).asScalar();t.push(m),b=m}return[d,v,b,t]}),g=Object(H["a"])(m,4);return this.c=g[0],this.h=g[1],this.lastSample=g[2],O=g[3],O.map(function(e){return t.decodeSample(e.dataSync()[0])})}},{key:"decodeSample",value:function(t){for(var e=0,n=0;n<rt.length;n++){var i=rt[n],r=Object(H["a"])(i,3),a=r[0],s=r[1],c=r[2];if(e<=t&&t<=e+c-s)switch(a){case tt:case et:return{event:a,note:t-e};case nt:return{event:a,value:(t-e+1)/Z};case it:return{event:a,value:(t-e+1)*Math.ceil(127/Q)};default:throw new Error("Could not decode eventType: ".concat(a))}e+=c-s+1}throw new Error("Could not decode index: ".concat(t))}}]),t}(),ot=n("2ef0"),lt=n.n(ot),ht=n("8cc4"),ft=n.n(ht);function pt(t){return lt.a.every(t,function(t){return t.isValid})}function dt(t){return t.filter(function(t){return t.event===tt}).map(function(t){return{note:Object(ht["Frequency"])(t.note,"midi").toNote(),isValid:!1}})}var vt,bt,Ot,mt,gt,yt=function(){function t(e){var n=e.target;Object(b["a"])(this,t),this.validInputs=[],this.currentInput=[],this.targets=dt(n),this.isValid=!1}return Object(O["a"])(t,[{key:"addInputs",value:function(t){var e=dt(t),n=this.targets.slice(this.validInputs.length);e.forEach(function(t,e){var i=n[e];t.isValid=i&&i.note===t.note}),pt(e)?(this.validInputs=this.validInputs.concat(e),this.currentInput=[]):this.currentInput=e,this.validInputs.length===this.targets.length&&(this.isValid=!0)}}]),t}(),jt=100,_t=127,wt=3,kt=2,It=function(){function t(e){var n=e.device,i=e.rnn,r=e.timeScale,a=void 0===r?1:r;Object(b["a"])(this,t),Object(_["a"])(this,"onDeviceNoteOff",this.onDeviceNoteOn),this.device=n,this.rnn=i,this.timeScale=a,this.events=[],this.inputEvents=[],this.device.$on(tt,this.onDeviceNoteOn.bind(this)),this.device.$on(et,this.onDeviceNoteOff.bind(this))}return Object(O["a"])(t,[{key:"generate",value:function(t){var e=this;this.events=[],this.inputEvents=[];var n=0;while(n<t&&this.events.length<1e3){var i=this.rnn.generateSteps();i.forEach(function(t){e.events.push(t),t.event===nt&&(n+=t.value*e.timeScale)})}return this.result=new yt({target:this.events}),this.result}},{key:"play",value:function(){var t=this,e=jt,n=0,i={},r=this.device.noteOn.bind(this.device),a=this.device.noteOff.bind(this.device);this.events.forEach(function(s){switch(s.event){case tt:i[s.note]=n,lt.a.delay(r,1e3*n*t.timeScale,s.note,e);break;case et:lt.a.has(i,s.note)&&(delete i[s.note],lt.a.delay(a,1e3*n*t.timeScale,s.note));break;case nt:n+=s.value,lt.a.forOwn(lt.a.pickBy(i,function(t){return n-t>=wt}),function(e,r){delete i[r],lt.a.delay(a,1e3*n*t.timeScale,r)});break;case it:e=Math.min(s.value,_t);break;default:break}})}},{key:"onDeviceNoteOn",value:function(t){0!==this.events.length&&(0===this.inputEvents.length&&lt.a.delay(this.checkInput.bind(this),1e3*kt),this.inputEvents.push(t))}},{key:"checkInput",value:function(){this.result.addInputs(this.inputEvents),this.inputEvents=[]}}]),t}(),xt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("b-container",[n("b-row",[n("b-col",[n("b-list-group",[n("b-list-group-item",{attrs:{variant:"primary"}},[n("strong",[t._v("Song")])]),t._l(t.validTargets,function(e){return n("b-list-group-item",[t._v("\n                    "+t._s(e.note)+"\n                ")])}),t._l(t.uncompletedTargets,function(e){return n("b-list-group-item",{attrs:{variant:"light"}},[t._v("\n                    ???\n                ")])})],2)],1),n("b-col",[n("b-list-group",[n("b-list-group-item",{attrs:{variant:"primary"}},[n("strong",[t._v("Your play")])]),t._l(t.result.validInputs,function(e){return n("b-list-group-item",{attrs:{variant:"info"}},[t._v("\n                    "+t._s(e.note)+"\n                ")])}),t._l(t.result.currentInput,function(e){return n("b-list-group-item",{attrs:{variant:e.isValid?"success":"danger"}},[t._v("\n                    "+t._s(e.note)+"\n                ")])})],2)],1)],1)],1)},Mt=[],St=(vt=k()({props:{result:Object}}),vt(bt=function(t){function e(){return Object(b["a"])(this,e),Object(m["a"])(this,Object(g["a"])(e).apply(this,arguments))}return Object(y["a"])(e,t),Object(O["a"])(e,[{key:"validTargets",get:function(){return this.result.targets.slice(0,this.result.validInputs.length)}},{key:"uncompletedTargets",get:function(){return this.result.targets.slice(this.result.validInputs.length)}}]),e}(c["default"]))||bt),Et=St,Nt=Object(M["a"])(Et,xt,Mt,!1,null,"1c8b48fa",null),Dt=Nt.exports,Rt=(Ot=k()({components:{"result-display":Dt}}),Ot((gt=function(t){function e(){var t,n;Object(b["a"])(this,e);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return n=Object(m["a"])(this,(t=Object(g["a"])(e)).call.apply(t,[this].concat(r))),Object(_["a"])(Object(j["a"])(Object(j["a"])(n)),"ready",!1),Object(_["a"])(Object(j["a"])(Object(j["a"])(n)),"error",null),Object(_["a"])(Object(j["a"])(Object(j["a"])(n)),"result",null),Object(_["a"])(Object(j["a"])(Object(j["a"])(n)),"status",null),Object(_["a"])(Object(j["a"])(Object(j["a"])(n)),"generateSeconds",3),Object(_["a"])(Object(j["a"])(Object(j["a"])(n)),"eventsManager",null),n}return Object(y["a"])(e,t),Object(O["a"])(e,[{key:"created",value:function(){var t=Object(F["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e=new ut,t.next=4,e.init();case 4:this.eventsManager=new It({device:this.$MIDI,onResult:this.onResult,rnn:e}),this.ready=!0,t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](0),console.error(t.t0),this.error=t.t0.message;case 12:case"end":return t.stop()}},t,this,[[0,8]])}));function e(){return t.apply(this,arguments)}return e}()},{key:"generate",value:function(){this.status="Generating melody...",this.result=this.eventsManager.generate(this.generateSeconds),this.status=null,this.eventsManager.play(),this.status="Enter melody please"}},{key:"play",value:function(){this.result?this.eventsManager.play():this.generate()}},{key:"isCompleted",get:function(){return this.result&&this.result.isValid}}]),e}(c["default"]),mt=gt))||mt),Ct=Rt,Lt=(n("41fc"),Object(M["a"])(Ct,B,W,!1,null,"6bded86a",null)),$t=Lt.exports;c["default"].use(A["a"]);var Pt=new A["a"]({mode:"history",base:"/piano-trainer/",routes:[{path:"/",name:"home",component:$t}]}),Tt=n("2f62");c["default"].use(Tt["a"]);var zt=new Tt["a"].Store({state:{},mutations:{},actions:{}}),Vt=n("774e"),At=n.n(Vt),Bt=n("42fc"),Wt="https://storage.googleapis.com/download.magenta.tensorflow.org/demos/SalamanderPiano/",Ft=127,Ht=function(){function t(){Object(b["a"])(this,t),this.name="Virtual Piano",this.piano=new Bt["Piano"]({velocities:4}).toMaster(),this.initalized=!1}return Object(O["a"])(t,[{key:"init",value:function(){var t=Object(F["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.initalized){t.next=4;break}return t.next=3,this.piano.load(Wt);case 3:this.initalized=!0;case 4:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"noteOn",value:function(t,e){this.piano.keyDown(t,ft.a.now(),e/Ft)}},{key:"noteOff",value:function(t){this.piano.keyUp(t)}}]),t}(),Ut=144,Gt=128,qt=function(){function t(e){var n=e.output;Object(b["a"])(this,t),this.name=n.name,this.output=n,this.initalized=!0}return Object(O["a"])(t,[{key:"noteOn",value:function(t,e){this.output.send([Ut,t,e])}},{key:"noteOff",value:function(t){this.output.send([Gt,t,0])}}]),t}(),Jt=144,Yt=128,Kt=function(){function t(e){var n=e.input,i=e.onNoteOn,r=e.onNoteOff;Object(b["a"])(this,t),this.name=n.name,this.input=n,this.onNoteOn=i,this.onNoteOff=r,this.input.onmidimessage=this.onMidiMessage.bind(this)}return Object(O["a"])(t,[{key:"onMidiMessage",value:function(t){var e=Object(H["a"])(t.data,3),n=e[0],i=e[1],r=e[2];switch(n){case Jt:this.onNoteOn(i,r);break;case Yt:this.onNoteOff(i);break;default:break}}}]),t}(),Qt=function t(){Object(b["a"])(this,t),this.name="Unknown"},Xt={install:function(t){var e=new t({data:function(){return{piano:new Ht,inputs:[],outputs:[],currentInput:null,currentOutput:null}},created:function(){var t=Object(F["a"])(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,window.navigator.requestMIDIAccess();case 2:return e=t.sent,t.next=5,this.setFromMIDIAccess(e);case 5:e.onstatechange=this.onStateChange;case 6:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),methods:{setFromMIDIAccess:function(){var t=Object(F["a"])(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.inputs=At()(e.inputs.values()),this.outputs=At()(e.outputs.values()),!this.outputs.length){t.next=6;break}this.currentOutput=new qt({output:this.outputs[0]}),t.next=9;break;case 6:return this.currentOutput=this.piano,t.next=9,this.piano.init();case 9:this.inputs.length?this.currentInput=new Kt({input:this.inputs[0],onNoteOn:this.onNoteOn,onNoteOff:this.onNoteOff}):this.currentInput=new Qt;case 10:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),onStateChange:function(){var t=Object(F["a"])(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.setFromMIDIAccess(e.target);case 2:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),noteOn:function(t,e){this.currentOutput.noteOn(t,e)},noteOff:function(t){this.currentOutput.noteOff(t)},onNoteOn:function(t,e){this.$emit(tt,{event:tt,note:t,velocity:e})},onNoteOff:function(t){this.$emit(et,{event:et,note:t})}}});Object.defineProperty(t.prototype,"$MIDI",{get:function(){return e}})}};n("f9e3"),n("2dd8");o["c"].add(l["b"],l["a"]),c["default"].component("fa-icon",h["a"]),c["default"].use(u["a"]),c["default"].use(Xt),c["default"].config.productionTip=!1,new c["default"]({router:Pt,store:zt,render:function(t){return t(V)}}).$mount("#app")},"57e2":function(t,e,n){"use strict";var i=n("3854"),r=n.n(i);r.a},b4e0:function(t,e,n){"use strict";var i=n("d306"),r=n.n(i);r.a},c2ed:function(t,e,n){"use strict";var i=n("f7a7"),r=n.n(i);r.a},d306:function(t,e,n){},ee77:function(t,e,n){},f7a7:function(t,e,n){}});
//# sourceMappingURL=app.2206da70.js.map